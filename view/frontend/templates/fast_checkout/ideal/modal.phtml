<?php
declare(strict_types=1);

/** @version 2.0.20 */

use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;
use LokiCheckout\PayNl\ViewModel\IdealFastCheckout;
use Loki\Components\Factory\ViewModelFactory;
use Loki\Components\Util\Block\ImageRenderer;

/** @var Escaper $escaper */
/** @var Template $block */
/** @var ViewModelFactory $viewModelFactory */
/** @var IdealFastCheckout $idealFastCheckout */
/** @var ImageRenderer $imageRenderer */

$idealFastCheckout = $viewModelFactory->create(IdealFastCheckout::class);
$shippingAddress = $idealFastCheckout->getShippingAddress();

?>
<div x-data="LokiModal">
    <button
        type="button"
        @click="toggleModal"
        class="<?= $escaper->escapeHtml($css('btn inline-flex items-center gap-4 bg-white hover:bg-gray-100 active:bg-gray-200 text-gray-950 rounded-lg', 'modal-trigger')) ?>"
    >
        <?= $escaper->escapeHtml(__('Checkout with')) ?>
        <?= /* @noEscape */ $imageRenderer->get(
            'LokiCheckout_PayNl::images/ideal.svg',
            [
                'aria-label' => 'iDEAL',
                'width' => '48',
                'height' => '48'
            ]
        ) ?>
    </button>

    <dialog x-ref="modal" class="<?= $escaper->escapeHtml($css('border border-zinc-200 rounded-lg shadow-lg p-10 text-start', 'dialog')) ?>">
        <div class="flex items-start gap-8">
            <button
                type="button"
                @click="toggleModal"
                class="<?= $escaper->escapeHtml($css('order-last', 'dialog-close')) ?>"
            >
                <?= /* @noEscape */ $imageRenderer->icon($block, 'xmark') ?>
            </button>

            <div class="<?= $escaper->escapeHtml($css('flex flex-wrap items-center gap-y-4 gap-x-8', 'dialog-inner')) ?>">
                <div class="<?= $escaper->escapeHtml($css('', 'dialog-inner-logo')) ?>">
                    <?= /* @noEscape */ $imageRenderer->get('Paynl_Payment::images/ideal-visual.webp', ['alt' => '', 'width' => '224', 'height' => '200']) ?>
                </div>
                <div class="<?= $escaper->escapeHtml($css('', 'dialog-inner-content')) ?>">
                    <p class="<?= $escaper->escapeHtml($css('text-3xl', 'dialog-inner-content-label')) ?>">
                        <strong class="font-normal">
                            <span class="<?= $escaper->escapeHtml($css('text-[#cc0066]', 'dialog-inner-content-label-span')) ?>">
                                <?= $escaper->escapeHtml(__('Order faster')) ?>
                            </span>
                            <?= $escaper->escapeHtml(__('with iDEAL fast checkout')) ?>
                        </strong>
                    </p>
                    <p class="<?= $escaper->escapeHtml($css('mt-4 mb-8', 'dialog-inner-content-teaser')) ?>">
                        <?= $escaper->escapeHtml(__('Create an iDEAL profile and save your address for your next order')) ?>
                    </p>
                    <form action="/paynl/checkout/fastcheckoutstart" method="post">
                        <input
                            type="hidden"
                            value="<?= $escaper->escapeHtml($shippingAddress->getCountryId()) ?>"
                            name="selected_estimate_country"
                        >
                        <input
                            type="hidden"
                            value="<?= $escaper->escapeHtml($shippingAddress->getPostcode()) ?>"
                            name="selected_estimate_zip"
                        >
                        <div class="flex flex-wrap gap-4">
                            <button
                                type="submit"
                                class="<?= $escaper->escapeHtml($css('btn bg-[#cc0066] hover:bg-[#a40052] hover:text-white text-white border-transparent rounded-lg py-4 px-6', 'fast-checkout-button')) ?>"
                            >
                                <?= $escaper->escapeHtml(__('Fast Checkout')) ?>
                            </button>
                            <button
                                type="button"
                                @click="toggleModal"
                                class="<?= $escaper->escapeHtml($css('btn border-transparent rounded-lg py-4 px-6', 'regular-button')) ?>"
                            >
                                <?= $escaper->escapeHtml(__('Enter my own address and pay')) ?>
                            </button>
                        </div>
                        <?= /* @noEscape */ $block->getBlockHtml('formkey') ?>
                    </form>
                </div>
            </div>
        </div>
    </dialog>
</div>
